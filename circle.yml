machine:
  node:
    version: 8.1.2
  environment:
    PATH: "${PATH}:${HOME}/${CIRCLE_PROJECT_REPONAME}/node_modules/.bin"

dependencies:
  pre:
    - curl -o- -L https://yarnpkg.com/install.sh | bash
    # https://github.com/facebook/relay/issues/1644#issuecomment-315998313
    - if [[ ! -e watchman ]]; then git clone https://github.com/facebook/watchman.git && cd watchman/ && git checkout v4.7.0 && ./autogen.sh && ./configure && make; fi
    - cd watchman && sudo make install
    - sudo sysctl fs.inotify.max_user_watches=524288
    - sudo sysctl -p
  override:
    - yarn
  cache_directories:
    - ~/.cache/yarn
    - watchman

test:
  override:
    - yarn test
